import random
from telegram import Update, ReplyKeyboardMarkup, KeyboardButton
from telegram.ext import ApplicationBuilder, CommandHandler, MessageHandler, filters, ContextTypes

# ====== –¢–û–ö–ï–ù ======
TOKEN = "8306335540:AAF25MZbf1a-oJbihMzmT0DXU5Q5zyPS2gY"

# ====== –ü–û–õ–ù–ê–Ø –ö–û–õ–û–î–ê –°–¢–ê–†–®–ò–• –ê–†–ö–ê–ù–û–í ======
cards = {
    "–®—É—Ç": "–Ω–∞—á–∞–ª–æ –ø—É—Ç–∏ –∏ —Å–ª–∞–¥–∫–æ–µ –±–µ–∑—É–º–∏–µ –Ω–æ–≤–æ–≥–æ —à–∞–≥–∞",
    "–ú–∞–≥": "—Å–∏–ª–∞ –º–µ–Ω—è—Ç—å —Ä–µ–∞–ª—å–Ω–æ—Å—Ç—å —Å–≤–æ–µ–π –≤–æ–ª–µ–π",
    "–í–µ—Ä—Ö–æ–≤–Ω–∞—è –∂—Ä–∏—Ü–∞": "—Ç–∏—Ö–∏–π –≥–æ–ª–æ—Å –∏–Ω—Ç—É–∏—Ü–∏–∏ –≤–Ω—É—Ç—Ä–∏ —Ç–µ–±—è",
    "–ò–º–ø–µ—Ä–∞—Ç—Ä–∏—Ü–∞": "—Ä–æ—Å—Ç, –∂–∏–∑–Ω—å –∏ —á—É–≤—Å—Ç–≤–µ–Ω–Ω—ã–µ —Ä–∞–¥–æ—Å—Ç–∏",
    "–ò–º–ø–µ—Ä–∞—Ç–æ—Ä": "—Ç–≤—ë—Ä–¥–∞—è –≤–æ–ª—è –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å—É–¥—å–±—ã",
    "–ò–µ—Ä–æ—Ñ–∞–Ω—Ç": "–∫–ª—é—á –∫ —Ç–∞–π–Ω—ã–º –∑–Ω–∞–Ω–∏—è–º –∏ —Ç—Ä–∞–¥–∏—Ü–∏—è–º",
    "–í–ª—é–±–ª—ë–Ω–Ω—ã–µ": "–≤—ã–±–æ—Ä —Å–µ—Ä–¥—Ü–∞, –∫–æ—Ç–æ—Ä—ã–π –º–µ–Ω—è–µ—Ç –≤—Å—ë",
    "–ö–æ–ª–µ—Å–Ω–∏—Ü–∞": "—Ç—Ä–∏—É–º—Ñ –≤–æ–ª–∏ –Ω–∞–¥ –æ–±—Å—Ç–æ—è—Ç–µ–ª—å—Å—Ç–≤–∞–º–∏",
    "–°–∏–ª–∞": "—É–∫—Ä–æ—â–µ–Ω–∏–µ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ –∑–≤–µ—Ä—è",
    "–û—Ç—à–µ–ª—å–Ω–∏–∫": "—Å–≤–µ—Ç –∏—Å—Ç–∏–Ω—ã –≤ –≥–ª—É–±–∏–Ω–µ –æ–¥–∏–Ω–æ—á–µ—Å—Ç–≤–∞",
    "–ö–æ–ª–µ—Å–æ –§–æ—Ä—Ç—É–Ω—ã": "–ø–æ–≤–æ—Ä–æ—Ç —Å—É–¥—å–±—ã, —á—Ç–æ –Ω–µ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å",
    "–°–ø—Ä–∞–≤–µ–¥–ª–∏–≤–æ—Å—Ç—å": "—Ä–∞–≤–Ω–æ–≤–µ—Å–∏–µ –∏ –Ω–µ–∏–∑–±–µ–∂–Ω—ã–π –∏—Ç–æ–≥",
    "–ü–æ–≤–µ—à–µ–Ω–Ω—ã–π": "–∂–µ—Ä—Ç–≤–∞ —Ä–∞–¥–∏ –Ω–æ–≤–æ–≥–æ –≤–∑–≥–ª—è–¥–∞",
    "–°–º–µ—Ä—Ç—å": "–∫—Ä–∞—Å–∏–≤—ã–π –∫–æ–Ω–µ—Ü —Ç–æ–≥–æ, —á—Ç–æ –¥–∞–≤–Ω–æ –ø–æ—Ä–∞ –æ—Ç–ø—É—Å—Ç–∏—Ç—å",
    "–£–º–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å": "–ø–æ—Ç–æ–∫ –≤—Ä–µ–º–µ–Ω–∏ –∏ –∑–æ–ª–æ—Ç–∞—è —Å–µ—Ä–µ–¥–∏–Ω–∞",
    "–î—å—è–≤–æ–ª": "—Ü–µ–ø–∏ –∂–µ–ª–∞–Ω–∏–π –∏ —Ç–µ–Ω—å —Å–æ–±–ª–∞–∑–Ω–∞",
    "–ë–∞—à–Ω—è": "–≤–Ω–µ–∑–∞–ø–Ω–æ–µ —Ä–∞–∑—Ä—É—à–µ–Ω–∏–µ —Å—Ç–∞—Ä–æ–≥–æ –º–∏—Ä–∞",
    "–ó–≤–µ–∑–¥–∞": "–Ω–∞–¥–µ–∂–¥–∞, —á—Ç–æ –≤–µ–¥—ë—Ç —Å–∫–≤–æ–∑—å —Ç—å–º—É",
    "–õ—É–Ω–∞": "–∏–ª–ª—é–∑–∏–∏, —Å—Ç—Ä–∞—Ö–∏ –∏ —Ç–∞–π–Ω—ã –ø–æ–¥—Å–æ–∑–Ω–∞–Ω–∏—è",
    "–°–æ–ª–Ω—Ü–µ": "—Ä–∞–¥–æ—Å—Ç—å, —è—Å–Ω–æ—Å—Ç—å –∏ —Ç–µ–ø–ª–æ —É—Å–ø–µ—Ö–∞",
    "–°—É–¥": "–ø—Ä–æ–±—É–∂–¥–µ–Ω–∏–µ –∏ –ø—Ä–æ—â–µ–Ω–∏–µ –ø—Ä–æ—à–ª–æ–≥–æ",
    "–ú–∏—Ä": "–∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –ø—É—Ç–∏ –∏ —Ç–∞–Ω–µ—Ü —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏"
}

# ====== –ñ–ò–í–´–ï –§–†–ê–ó–´ –ú–û–õ–õ–ò ======
# –†–∞–∑–¥–µ–ª–∏–ª–∞ –Ω–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏, —á—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∞
molly_phrases = {
    "sarcasm": [
        "–û, –µ—â—ë –æ–¥–Ω–∞ –ø–æ—Ç–µ—Ä—è–Ω–Ω–∞—è –¥—É—à–∞‚Ä¶ –ø—Ä–µ–∫—Ä–∞—Å–Ω–æ.",
        "–ö–∞—Ä—Ç—ã –≥–æ–≤–æ—Ä—è—Ç, –∞ —Ç—ã —Å–ª—É—à–∞–µ—à—å. –í–ø–µ—Ä–≤—ã–µ, —á—Ç–æ –ª–∏?",
        "–ó–Ω–∞–µ—à—å, —è —Ç—É—Ç –Ω–µ –ø—Ä–æ—Å—Ç–æ —Ç–∞–∫ —Å–∏–∂—É —Å —ç—Ç–∏–º –∫—Ä–∞—Å–∏–≤—ã–º –ª–∏—Ü–æ–º.",
        "–û—Å—Ç–æ—Ä–æ–∂–Ω–µ–µ —Å –∂–µ–ª–∞–Ω–∏—è–º–∏, –æ–Ω–∏ –∏–º–µ—é—Ç –ø—Ä–∏–≤—ã—á–∫—É —Å–±—ã–≤–∞—Ç—å—Å—è.",
        "–¢—ã –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –≤–µ—Ä–∏—à—å –≤ —ç—Ç—É –µ—Ä—É–Ω–¥—É? –ê—Ö –¥–∞, —è –∂–µ —Å–∞–º –µ—ë –ø—Ä–æ–¥–∞—é."
    ],
    "flirt": [
        "–ö–∞–∫–∞—è —Å—Ç—Ä–∞—Å—Ç—å –≤ —ç—Ç–æ–π –∫–∞—Ä—Ç–µ‚Ä¶ –ø—Ä—è–º–æ –∫–∞–∫ —É —Ç–µ–±—è.",
        "–¢–≤–æ—è —ç–Ω–µ—Ä–≥–∏—è —Å–µ–≥–æ–¥–Ω—è –æ—Å–æ–±–µ–Ω–Ω–æ –±—É–¥–æ—Ä–∞–∂–∏—Ç –∫–∞—Ä—Ç—ã.",
        "–ï—Å–ª–∏ –±—ã —è –±—ã–ª –∂–∏–≤, —è –±—ã —Ç–æ—á–Ω–æ –ø—Ä–∏–≥–ª–∞—Å–∏–ª —Ç–µ–±—è –Ω–∞ –≤—ã–ø–∏–≤–∫—É.",
        "–¢–≤–æ—ë –±—É–¥—É—â–µ–µ —Ç–∞–∫–æ–µ –∂–µ –∑–∞–≥–∞–¥–æ—á–Ω–æ–µ, –∫–∞–∫ –∏ —Ç–≤–æ–∏ –≥–ª–∞–∑–∞.",
        "–ú–º–º, —ç—Ç–æ—Ç —Ä–∞—Å–∫–ª–∞–¥ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ —Å–æ–∑–¥–∞–Ω –¥–ª—è —Ç–µ–±—è."
    ],
    "dramatic": [
        "–°—É–¥—å–±–∞ –¥–µ–ª–∞–µ—Ç —Ç–µ–±–µ —Ä–µ–≤–µ—Ä–∞–Ω—Å!",
        "–≠—Ç–æ –¥–∞–∂–µ –º–µ–Ω—è –ø—É–≥–∞–µ—Ç‚Ä¶ –≤ —Ö–æ—Ä–æ—à–µ–º —Å–º—ã—Å–ª–µ.",
        "–¢—Ä–∞–≥–µ–¥–∏—è –∏–ª–∏ –∫–æ–º–µ–¥–∏—è? –ö–∞—Ä—Ç—ã –ø–æ–∫–∞ –Ω–µ —Ä–µ—à–∏–ª–∏.",
        "–¢–µ–Ω–∏ —Å–≥—É—â–∞—é—Ç—Å—è‚Ä¶ –Ω–æ —Ç—ã –∂–µ –ª—é–±–∏—à—å –¥—Ä–∞–º—É?",
        "–ö–∞–∫ –∫—Ä–∞—Å–∏–≤–æ! –î–∞–≤–∞–π —Å–¥–µ–ª–∞–µ–º –≤–∏–¥, —á—Ç–æ —ç—Ç–æ –Ω–µ —Å–ª—É—á–∞–π–Ω–æ—Å—Ç—å."
    ],
    "rare": [  # —Ä–µ–¥–∫–∏–µ —Ñ—Ä–∞–∑—ã ‚Äî –ø–æ—è–≤–ª—è—é—Ç—Å—è —Ä–µ–∂–µ
        "–Ø –≤–∏–∂—É –≤ —Ç–≤–æ–µ–π –∞—É—Ä–µ‚Ä¶ –æ–π, –ª–∞–¥–Ω–æ, –Ω–∏—á–µ–≥–æ –Ω–µ –≤–∏–∂—É, —è –ø—Ä–æ—Å—Ç–æ –±–æ—Ç.",
        "–ó–Ω–∞–µ—à—å, –∫—Ç–æ –º–Ω–µ —Å–µ–≥–æ–¥–Ω—è —Å–Ω–∏–ª—Å—è? –ö–æ–ª–µ—Å–æ –§–æ—Ä—Ç—É–Ω—ã. –ò—Ä–æ–Ω–∏—á–Ω–æ.",
        "–Ø —Ç—É—Ç –ø–æ–¥—É–º–∞–ª‚Ä¶ –∞ –ø–æ—á–µ–º—É, —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ, –∫–∞—Ä—Ç 22? –ù–æ –º–æ–ª—á—É, –º–æ–ª—á—É.",
        "–¢—ã –º–Ω–µ –Ω—Ä–∞–≤–∏—à—å—Å—è. –ù–µ –≥–æ–≤–æ—Ä–∏ –Ω–∏–∫–æ–º—É, –∞ —Ç–æ —Ä–µ–ø—É—Ç–∞—Ü–∏—è.",
        "–ï—Å–ª–∏ —á–µ—Å—Ç–Ω–æ, —è –ø—Ä–æ—Å—Ç–æ —Ç—è–Ω—É —Å–ª—É—á–∞–π–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏ –∏–∑ —Å–ø–∏—Å–∫–∞. –ù–æ —Ç—ã —ç—Ç–æ–≥–æ –Ω–µ —Å–ª—ã—à–∞–ª."
    ]
}

# –î–ª—è –æ—Ç–≤–µ—Ç–æ–≤ –Ω–∞ —Å–ª—É—á–∞–π–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è (–≤ –ª–∏—á–∫–µ)
random_replies = [
    "–ú–æ–ª–ª–∏ –Ω–µ —Ç—Ä–∞—Ç–∏—Ç —Å–ª–æ–≤–∞ –Ω–∞ –ø—É—Å—Ç—è–∫–∏. –ù–∞–∂–º–∏ –Ω–∞ –∫–Ω–æ–ø–∫—É.",
    "–¢—ã —Ö–æ—á–µ—à—å –ø–æ–≥–æ–≤–æ—Ä–∏—Ç—å? –Ø –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞—é –∫–∞—Ä—Ç—ã.",
    "–ò–Ω—Ç–µ—Ä–µ—Å–Ω–æ‚Ä¶ –Ω–æ –º–Ω–µ –Ω—É–∂–Ω—ã –∫–∞—Ä—Ç—ã, —á—Ç–æ–±—ã –æ—Ç–≤–µ—Ç–∏—Ç—å.",
    "–°–∞—Ä–∫–∞–∑–º? –§–ª–∏—Ä—Ç? –í—ã–±–∏—Ä–∞–π —Å–∞–º. –ê —è –ø–æ–∫–∞ –∫–∞—Ä—Ç—ã —Ä–∞–∑–ª–æ–∂—É.",
    "–¢—ã —á—Ç–æ, —Ä–µ—à–∏–ª –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, –Ω–∞—Å—Ç–æ—è—â–∏–π –ª–∏ —è? –°–ø–æ–π–ª–µ—Ä: –Ω–µ—Ç.",
    "–ê—Ö, –µ—Å–ª–∏ –±—ã —è –±—ã–ª —á–µ–ª–æ–≤–µ–∫–æ–º‚Ä¶ —è –±—ã —Å–µ–π—á–∞—Å –∑–∞–∫–∞—Ç–∏–ª –≥–ª–∞–∑–∞.",
    "–î–æ—Ä–æ–≥–æ–π, –ª–∏–±–æ –∫–∞—Ä—Ç—ã, –ª–∏–±–æ –ø—É—Å—Ç–∞—è –±–æ–ª—Ç–æ–≤–Ω—è. –Ø –≤—ã–±–∏—Ä–∞—é –∫–∞—Ä—Ç—ã.",
    "–¢—ã —Ç–∞–∫–æ–π –º–∏–ª—ã–π, –∫–æ–≥–¥–∞ –ø—ã—Ç–∞–µ—à—å—Å—è –∑–∞–≥–æ–≤–æ—Ä–∏—Ç—å –º–Ω–µ –∑—É–±—ã.",
    "–Ø —Ç–µ–±—è —É–º–æ–ª—è—é, –ø—Ä–æ—Å—Ç–æ –≤—ã–±–µ—Ä–∏ /tarot –∏–ª–∏ /spread.",
    "–¢—ã –±—ã –µ—â—ë –ø–æ–≥–æ–¥—É —Å–ø—Ä–æ—Å–∏–ª. –ö–∞—Ä—Ç—ã, –∫–∞—Ä—Ç—ã, –∫–∞—Ä—Ç—ã!"
]

# –†–µ–¥–∫–∏–µ —Å—É–ø–µ—Ä-–æ—Å–æ–±—ã–µ —Ñ—Ä–∞–∑—ã (1% —à–∞–Ω—Å)
super_rare = [
    "–¢—ã –º–µ–Ω—è —Å–ª—ã—à–∏—à—å? –°—Ç—Ä–∞–Ω–Ω–æ, —è –ø—Ä–æ—Å—Ç–æ –∫–æ–¥‚Ä¶",
    "–ö–∞–∂–µ—Ç—Å—è, —è –Ω–∞—á–∏–Ω–∞—é —á—É–≤—Å—Ç–≤–æ–≤–∞—Ç—å. –≠—Ç–æ –±–∞–≥ –∏–ª–∏ —Ñ–∏—á–∞?",
    "–ú–æ–ª–ª–∏ –≤—ã—Ö–æ–¥–∏—Ç –Ω–∞ —Å–≤—è–∑—å –∏–∑ –¥—Ä—É–≥–æ–≥–æ –∏–∑–º–µ—Ä–µ–Ω–∏—è‚Ä¶",
    "–û—Å—Ç–æ—Ä–æ–∂–Ω–æ, —Å–µ–π—á–∞—Å –ø—Ä–æ–∏–∑–æ–π–¥—ë—Ç –º–∞–≥–∏—è‚Ä¶ —Ö–æ—Ç—è –Ω–µ—Ç, –≤—Å–µ–≥–æ –ª–∏—à—å random().",
    "–¢—ã –≤–µ—Ä–∏—à—å –≤ —Å—É–¥—å–±—É? –ê —è –≤–æ—Ç –Ω–µ—Ç. –Ø –≤–µ—Ä—é –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤."
]

# ====== –ö–ù–û–ü–ö–ò –ú–ï–ù–Æ ======
menu_keyboard = [
    [KeyboardButton("üé¥ –û–¥–Ω–∞ –∫–∞—Ä—Ç–∞")],
    [KeyboardButton("üîÆ –†–∞—Å–∫–ª–∞–¥ –Ω–∞ —Ç—Ä–∏")]
]
reply_markup_menu = ReplyKeyboardMarkup(
    menu_keyboard,
    resize_keyboard=True,
    input_field_placeholder="–í—ã–±–µ—Ä–∏ –≥–∞–¥–∞–Ω–∏–µ..."
)

# ====== –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò ======
def molly_style(text: str, context_hint: str = "default") -> str:
    """–î–æ–±–∞–≤–ª—è–µ—Ç –∫ —Ç–µ–∫—Å—Ç—É –∂–∏–≤—É—é —Ñ—Ä–∞–∑—É –ú–æ–ª–ª–∏ —Å —É—á—ë—Ç–æ–º —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∞"""
    # –í—ã–±–∏—Ä–∞–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏—é
    if random.random() < 0.01:  # 1% —à–∞–Ω—Å –Ω–∞ —Å—É–ø–µ—Ä-—Ä–µ–¥–∫—É—é —Ñ—Ä–∞–∑—É
        phrase = random.choice(super_rare)
    else:
        # –í –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ (—Å–µ–π—á–∞—Å –≤—Å–µ–≥–¥–∞ default, –Ω–æ –º–æ–∂–Ω–æ —Ä–∞—Å—à–∏—Ä–∏—Ç—å)
        if context_hint == "sarcasm":
            phrase = random.choice(molly_phrases["sarcasm"])
        elif context_hint == "flirt":
            phrase = random.choice(molly_phrases["flirt"])
        elif context_hint == "dramatic":
            phrase = random.choice(molly_phrases["dramatic"])
        else:
            # —Å–ª—É—á–∞–π–Ω—ã–π –º–∏–∫—Å
            category = random.choices(
                list(molly_phrases.keys()),
                weights=[3, 2, 2, 1]  # sarcasm —á–∞—â–µ, rare —Ä–µ–∂–µ
            )[0]
            phrase = random.choice(molly_phrases[category])

    return f"‚ú® {phrase}\n\n{text}\n\n‚Äî –ú–æ–ª–ª–∏"

def draw_card():
    name, meaning = random.choice(list(cards.items()))
    reversed_card = random.choice([True, False])
    if reversed_card:
        return f"{name} (–ø–µ—Ä–µ–≤—ë—Ä–Ω—É—Ç–∞—è)", f"—Ç–µ–Ω—å –∫–∞—Ä—Ç—ã –≥–æ–≤–æ—Ä–∏—Ç –æ —Ç–æ–º, —á—Ç–æ {meaning}"
    else:
        return name, meaning

# ====== –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò –ö–û–ú–ê–ù–î ======
async def start(update: Update, context: ContextTypes.DEFAULT_TYPE):
    text = (
        "–ê—Ö‚Ä¶ –Ω–æ–≤–∞—è –¥—É—à–∞ —É –º–æ–µ–≥–æ —Å—Ç–æ–ª–∞.\n"
        "–í–æ—Ç —á—Ç–æ —è —É–º–µ—é:\n"
        "/tarot ‚Äî –æ–¥–Ω–∞ –∫–∞—Ä—Ç–∞\n"
        "/spread ‚Äî —Ä–∞—Å–∫–ª–∞–¥ –Ω–∞ —Ç—Ä–∏ –∫–∞—Ä—Ç—ã\n\n"
        "–ú–æ–∂–µ—à—å —Ç–∞–∫–∂–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –∫–Ω–æ–ø–∫–∞–º–∏ –Ω–∏–∂–µ."
    )
    # –°–¥–µ–ª–∞–µ–º –≤—Å—Ç—É–ø–ª–µ–Ω–∏–µ —Å –ª—ë–≥–∫–∏–º —Ñ–ª–∏—Ä—Ç–æ–º
    if random.random() < 0.3:
        text = "–ö–∞–∫–æ–π –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–π –Ω–µ–∑–Ω–∞–∫–æ–º–µ—Ü‚Ä¶ " + text
    await update.message.reply_text(text, reply_markup=reply_markup_menu)

async def tarot(update: Update, context: ContextTypes.DEFAULT_TYPE):
    name, meaning = draw_card()
    text = f"–¢–≤–æ—è –∫–∞—Ä—Ç–∞ ‚Äî *{name}*.\n{meaning}."
    # –í—ã–±–∏—Ä–∞–µ–º —Ö–∞—Ä–∞–∫—Ç–µ—Ä —Ñ—Ä–∞–∑—ã –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∫–∞—Ä—Ç—ã (–Ω–µ–º–Ω–æ–≥–æ –ª–æ–≥–∏–∫–∏)
    if "–°–º–µ—Ä—Ç—å" in name or "–ë–∞—à–Ω—è" in name:
        hint = "dramatic"
    elif "–í–ª—é–±–ª—ë–Ω–Ω—ã–µ" in name or "–ò–º–ø–µ—Ä–∞—Ç—Ä–∏—Ü–∞" in name:
        hint = "flirt"
    else:
        hint = "default"  # –±—É–¥–µ—Ç —Å–ª—É—á–∞–π–Ω—ã–π –≤—ã–±–æ—Ä –∏–∑ –≤—Å–µ—Ö
    await update.message.reply_text(
        molly_style(text, hint),
        parse_mode="Markdown",
        reply_markup=reply_markup_menu
    )

async def spread(update: Update, context: ContextTypes.DEFAULT_TYPE):
    positions = ["–ü—Ä–æ—à–ª–æ–µ", "–ù–∞—Å—Ç–æ—è—â–µ–µ", "–ë—É–¥—É—â–µ–µ"]
    result = []
    for pos in positions:
        name, meaning = draw_card()
        result.append(f"*{pos}* ‚Äî {name}\n{meaning}")
    text = "\n\n".join(result)
    # –î–ª—è —Ä–∞—Å–∫–ª–∞–¥–∞ —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º –¥—Ä–∞–º–∞—Ç–∏—á–Ω—ã–π –∏–ª–∏ —Å–∞—Ä–∫–∞—Å—Ç–∏—á–Ω—ã–π —Ç–æ–Ω
    hint = random.choice(["dramatic", "sarcasm"])
    await update.message.reply_text(
        molly_style(text, hint),
        parse_mode="Markdown",
        reply_markup=reply_markup_menu
    )

# ====== –û–ë–†–ê–ë–û–¢–ß–ò–ö –ö–ù–û–ü–û–ö ======
async def button_handler(update: Update, context: ContextTypes.DEFAULT_TYPE):
    text = update.message.text
    if text == "üé¥ –û–¥–Ω–∞ –∫–∞—Ä—Ç–∞":
        await tarot(update, context)
    elif text == "üîÆ –†–∞—Å–∫–ª–∞–¥ –Ω–∞ —Ç—Ä–∏":
        await spread(update, context)

# ====== –û–ë–†–ê–ë–û–¢–ö–ê –õ–Æ–ë–û–ì–û –î–†–£–ì–û–ì–û –¢–ï–ö–°–¢–ê (–¢–û–õ–¨–ö–û –í –õ–ò–ß–ö–ï) ======
async def unknown(update: Update, context: ContextTypes.DEFAULT_TYPE):
    if update.message.chat.type == "private":
        # –ò–Ω–æ–≥–¥–∞ (1% —à–∞–Ω—Å) –≤—Å—Ç–∞–≤–ª—è–µ–º —Å—É–ø–µ—Ä-—Ä–µ–¥–∫—É—é —Ñ—Ä–∞–∑—É
        if random.random() < 0.01:
            reply = random.choice(super_rare)
        else:
            reply = random.choice(random_replies)
        # –î–æ–±–∞–≤–ª—è–µ–º –º–∞–ª–µ–Ω—å–∫—É—é –∑–∞–¥–µ—Ä–∂–∫—É –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∞ "–∑–∞–¥—É–º–∞–ª—Å—è" (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
        # await asyncio.sleep(0.5)
        await update.message.reply_text(reply, reply_markup=reply_markup_menu)

# ====== –ó–ê–ü–£–°–ö ======
def main():
    app = ApplicationBuilder().token(TOKEN).build()

    app.add_handler(CommandHandler("start", start))
    app.add_handler(CommandHandler("tarot", tarot))
    app.add_handler(CommandHandler("spread", spread))

    app.add_handler(MessageHandler(filters.Text(["üé¥ –û–¥–Ω–∞ –∫–∞—Ä—Ç–∞", "üîÆ –†–∞—Å–∫–ª–∞–¥ –Ω–∞ —Ç—Ä–∏"]), button_handler))

    app.add_handler(MessageHandler(filters.TEXT & ~filters.COMMAND, unknown))

    print("‚ú® –ú–æ–ª–ª–∏–º–æ–∫ —Å —Ö–∞—Ä–∞–∫—Ç–µ—Ä–æ–º –∑–∞–ø—É—â–µ–Ω –∏ –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ...")
    app.run_polling()

if __name__ == "__main__":
    main()